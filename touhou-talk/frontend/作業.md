フロント（Next.js / UI）
app/(chat)/ChatClient.tsx　レ
/vscode/* API を叩くようにする
WorkMode を FastAPI の state と同期
Approve / Reject / Plan / Diff を API 駆動に変更

components/vscode/WorkPanel.tsx　レ
表示専用 → API 結果表示用に確定
plan / diff / apply の描画責務だけ持たせる
lib/vscode/client.ts（新規 or 既存なら拡張）
/vscode/session/start
/vscode/files
/vscode/plan
/vscode/diff
/vscode/permission/*
/vscode/commit
を叩く専用クライアント
バックエンド（FastAPI）

api/vscode.py（既にある）レ
UI からの呼び出し前提で確認・微調整
レスポンス形式を UI 向けに最終固定
（※ core 側はもう出来てるので基本いじらない）
VS Code Extension 側（実ファイル操作）

lib/vscode/types.tsレ
WorkMode / WorkPlan / FileDiff / DiffSet（UI用）
VS Code Extension


ーーーーーーーーーーーーーーーーーーーーーーー


vscode-extension/src/extension.ts
セッション開始 / 終了
コマンド登録

vscode-extension/src/fileCollector.ts
開いているファイル / Workspace 取得
{ path: content } 生成

vscode-extension/src/apiClient.ts
FastAPI /vscode/* 呼び出し
UI と同一 API を使用

vscode-extension/src/diffApplier.ts
DiffSet を解析
VS Code API で実ファイル書き換え
新設するファイル（最低限）
フロント


vscode-extension/src/types.ts
FastAPI と同型の型定義

vscode-extension/src/sessionStore.ts
session_id 保持用
これで「できるようになること」
Chat UI → 実ファイル編集まで完全貫通
差分必須・承認必須・暴走不可
UI / VS Code / FastAPI が同一セッションで同期
「AIが勝手に書く」は構造的に不可能